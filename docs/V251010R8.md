# V251010R8 변경 요약

## 1. 코드 변경 개요
- `usbHidSendReport()`에 즉시 전송 전용 슬롯을 추가해 큐가 비어 있고 HID 엔드포인트가 유휴 상태일 때는 큐를 거치지 않고 바로 전송하도록 복원했습니다.【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L186-L207】【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L1216-L1243】
- 즉시 전송이 성공하면 같은 컨텍스트에서 `usbHidSlotNotifySend()`와 `usbHidKickExtraTransfer()`를 호출해 Poll Rate 계측과 EXK 경로 재시도를 유지합니다.【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L202-L207】
- 큐가 필요한 상황에서는 기존 슬롯 예약/커밋 로직을 그대로 사용하되, 즉시 전송 경로가 선행 평가되도록 분기 순서를 재구성했습니다.【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L209-L224】
- 펌웨어 버전을 `V251010R8`로 갱신했습니다.【F:src/hw/hw_def.h†L9-L9】

## 2. Poll Rate 계측 변화 복구
1. 큐가 비어 있는 경우에는 전용 슬롯에서 바로 전송하기 때문에 `usbHidInstrumentationOnImmediateSendSuccess()`가 항상 `0` 백로그로 호출되어 `queued(max)`가 다시 `0`으로 유지됩니다.【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L198-L207】【F:src/hw/driver/usb/usb_hid/usbd_hid_instrumentation.c†L112-L118】
2. 즉시 전송이 실패해 큐에 적재되는 경우에도 기존 슬롯 API를 그대로 사용하므로, Data IN 콜백과 타이머 재시도가 동일한 시점에 실행되어 Poll Rate 초과 지연(`excess`) 산출 로직이 변경되지 않습니다.【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L209-L228】【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L1078-L1112】【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L1624-L1634】
3. EXK 큐는 즉시 전송 성공 시에도 `usbHidKickExtraTransfer()`가 바로 호출되어 기존처럼 키보드 파이프라인 종료 직후 재시도가 이루어집니다.【F:src/hw/driver/usb/usb_hid/usbd_hid.c†L204-L207】

## 3. Scan Rate 영향 검증 시나리오
- `matrix info on` 상태에서 1Hz/100Hz 키 입력을 반복하며 `Scan Rate` 수치가 V251010R7 대비 원상 복구되는지 확인합니다. 즉시 전송이 큐 연산을 생략하므로 스캔 루프가 다시 최대 빈도로 실행되어야 합니다.
- 같은 시나리오에서 `Poll Rate` 로그의 `queued(max)`와 `excess`가 각각 `0`, `0~1us` 범위로 회귀하는지 관찰합니다. 큐 적재가 발생하는 경우에도 Data IN 직후 재시도가 이루어지는지 확인합니다.

## 4. 빌드 및 테스트 결과
- `cmake -S . -B build -DKEYBOARD_PATH='/keyboards/era/sirind/brick60'`
- `cmake --build build -j10`
- 빌드 산출물 확인 후 `build` 디렉터리를 정리했습니다.
