# MONITOR Review 19 — 후보 개선안 검토 (V251006R9)

## 1. 후보 개선안 목록
1. **안정 임계값 이하 간격에서 누락 프레임·패널티 계산 생략**
2. **워밍업 프레임 카운터를 8비트로 축소하여 구조체 크기 감소**
3. **서스펜드 상태에서 `pdev->dev_speed` 읽기를 완전히 제거**

## 2. 후보별 검토
### 1) 안정 임계값 이하 간격에서 누락 프레임·패널티 계산 생략
- **성능 영향**: 워밍업 완료 이후 정상 SOF 구간은 대부분 임계값 이하이므로, `usbCalcMissedFrames()` 호출과 패널티 산술을 건너뛰면 ISR 평균 실행 시간이 단축된다. 미세하지만 누락 프레임이 없을 때 비용을 줄이는 직접적인 효과가 있다.
- **복잡도 변화**: `delta < stable_threshold` 분기에서 단순 조기 반환을 추가하는 수준으로, 기존 흐름과 정합성을 유지하면서 코드 가독성도 유지된다.
- **USB 불안정성 탐지 리스크**: 임계 초과 구간에 대해서는 기존 경로가 그대로 실행되므로 탐지 민감도는 동일하다. 워밍업 단계나 다운그레이드 트리거 조건과 충돌하지 않는다.
- **결론**: 적용.

### 2) 워밍업 프레임 카운터를 8비트로 축소하여 구조체 크기 감소
- **성능 영향**: 구조체 폭이 줄어 캐시 적중이 조금 나아질 수 있으나, 워밍업 카운터는 워밍업 중에만 접근되며 현행 16비트도 이미 최소 연산이다. 체감 성능 향상은 미미하다.
- **복잡도 변화**: 8비트로 축소하면 HS 워밍업 목표(2048프레임)를 표현할 수 없어 오버플로 제어 로직이 추가로 필요해진다. 복잡도가 상승한다.
- **USB 불안정성 탐지 리스크**: 오버플로 제어가 실패하면 워밍업이 조기 완료되어 잘못된 안정 판정을 내릴 수 있다. 비정상 동작 가능성이 높다.
- **결론**: 미적용.

### 3) 서스펜드 상태에서 `pdev->dev_speed` 읽기를 완전히 제거
- **성능 영향**: 서스펜드 구간에서 MMIO 접근을 더 줄이는 효과는 있으나, 이미 최초 진입 시 1회 읽기로 제한되어 있어 추가 체감 성능은 미미하다.
- **복잡도 변화**: 서스펜드 복귀 후 속도 파라미터 복원 경로가 사라져, Resume 시 Prime에서 정확한 속도 정보를 확보하기 위해 별도 캐시 또는 이벤트 신호가 필요해진다. 복잡도가 상승한다.
- **USB 불안정성 탐지 리스크**: Resume 직후 속도 파라미터가 최신 값으로 갱신되지 않으면 잘못된 기대 간격을 사용해 오탐/미탐 가능성이 있다. 비정상 동작 위험이 존재한다.
- **결론**: 미적용.

## 3. 최종 적용 내역
- 후보 1을 적용하여, 안정 임계 이하 구간에서 누락 프레임 및 패널티 계산을 건너뛰도록 수정한다.
