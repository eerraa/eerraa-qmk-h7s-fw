# MONITOR Review 29 (V251008R1)

## 후보 1: SOF 속도 캐시 및 HS/FS 판별 재사용
- 성능 영향: `usbHidMonitorSof()`에서 `mon->active_speed`와 HS/FS 판별을 반복 로드하던 경로를 지역 변수로 캐시해 서스펜드/속도 검사 분기에서의 비교 횟수와 메모리 접근을 줄였다. ISR 공통 경로에서 두 번 수행되던 비교가 한 번으로 줄어들어 미세하지만 주기적 비용이 감소한다.
- 복잡도 영향: 지역 변수 선언과 조건식 치환만으로 구조가 단순해졌으며, 기존 로직을 그대로 표현하므로 가독성도 유지된다.
- USB 불안정성 탐지 영향: 캐시된 값은 상태 전환 직후 Prime이 호출되면 즉시 반환되므로, 캐시와 실제 구조체 간 불일치가 발생하지 않는다. 속도 판별 자체를 축소할 뿐이어서 모니터링 조건은 변하지 않는다.
- 결론: 채택한다.

## 후보 2: 워밍업 누적 분기 단순화
- 성능 영향: 증가 여부 추적을 위한 `warmup_changed`/`warmup_incremented` 보조 변수를 제거하고, 증가/리셋 시점에서 바로 구조체를 갱신한 뒤 목표 미달 시 조기 반환하도록 재구성했다. 이에 따라 불필요한 비교 두 개와 논리 연산이 사라져 워밍업 구간 평균 경로가 가벼워진다.
- 복잡도 영향: 분기 수가 줄어 흐름이 “증가 → 목표 체크 → 타임아웃 검사”의 3단계로 명확해졌고, 값이 변할 때만 구조체를 쓰는 원칙도 그대로 유지된다.
- USB 불안정성 탐지 영향: 증가 직후 목표에 도달하면 즉시 완료 처리를 수행하며, 타임아웃 경로도 기존과 동일하게 유지되어 워밍업 완료 시점이 변하지 않는다. 리셋 후에는 마감 시각 비교를 계속 수행하므로 오동작 가능성도 없다.
- 결론: 채택한다.

## 후보 3: 홀드오프 구간에서 `usbHidSofMonitorSyncTick()` 호출 제거
- 성능 영향: 홀드오프 동안 `prev_tick`을 덮어쓰지 않으면 함수 호출 비용을 줄일 수 있으나, 이후 `delta_us` 계산이 큰 값으로 시작해 감쇠 및 다운그레이드 분기가 즉시 실행될 위험이 있다.
- 복잡도 영향: 추가 분기가 필요해 흐름이 오히려 복잡해진다.
- USB 불안정성 탐지 영향: `prev_tick`이 오래된 값으로 남으면 홀드오프 해제 첫 프레임에서 대규모 누락 프레임으로 판단되어 false positive가 발생할 수 있다.
- 결론: 보류한다.
