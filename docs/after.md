# 사후 개선 계획 (EEPROM 로그 경량화 & UART 출력 정책)

## 1. 목표 및 배경
- **EEPROM 경로 로그 경량화**: V251112R8까지의 리팩터링으로 큐/클린업 안정화는 확보했지만, 현재 부팅/초기화 단계에서 `[I2C] ready wait` 로그가 수백 줄 발생해 UART 대역을 잠식하고 있습니다. 주요 상태만 남기고, 반복 로그는 필요 시에만 출력되도록 조정해야 합니다.
- **UART 로그 보드 전용 설정**: 현재는 모든 빌드에서 UART 로그가 항상 활성화되어 SWD UART로 데이터를 송신합니다. 릴리스 빌드에서는 UART 로그가 기본 비활성화되고, 개발 빌드나 특정 보드에서만 opt-in 방식으로 켜지도록 정책을 바꿔야 합니다.

## 2. EEPROM 로그 경량화 계획
| 단계 | 작업 내용 | 세부 조치 |
| --- | --- | --- |
| 1 | Ready wait 로그 샘플링/요약 | `i2cWriteA16Bytes()` 완료 확인에서 매 페이지마다 `[I2C] ch1 ready wait begin/done`을 찍는 대신, 누적 카운터와 최댓값만 기록하고 완료 시 한 줄로 요약(예: `ready wait max=5ms count=8`). Debug 모드에서는 기존 로그 유지. |
| 2 | AUTO_FACTORY_RESET 진행 로그 축소 | 초기화 과정에서 반복되는 `[  ] EEPROM auto factory reset` 로그를 “시작/완료” 두 줄로 제한하고, 중간 플러시 상태는 CLI 계측으로 대체. 필요 시 `LOG_LEVEL_VERBOSE` 빌드옵션을 통해 확장. |
| 3 | `cli eeprom info` 보조 지표 활용 | 실시간 로그 대신 CLI 명령으로 큐/클린업/ready wait 통계를 확인하도록 문서(`docs/eeprom.md`)에 절차 추가. 사용자가 로그를 비워두고 CLI로만 관측하도록 안내. |

## 3. UART 로그 보드 전용 정책
| 단계 | 작업 내용 | 세부 조치 |
| --- | --- | --- |
| A | 빌드타임 플래그 도입 | `hw_def.h` 또는 보드별 `config.h`에 `HW_LOG_ENABLE_DEFAULT`(기본값 0)를 정의. 개발용 보드만 1로 재정의. |
| B | `hwInit()` 조건부 초기화 | `logOpen()` 호출을 `if (HW_LOG_ENABLE_DEFAULT)`로 감싸고, CLI 명령이나 `logEnable()` API로 런타임에서도 토글 가능하도록 문서화. |
| C | 릴리스 빌드 검증 | UART 로그 비활성 상태에서 필수 정보가 모두 USB/CLI로 확인 가능한지 테스트. 필요 로그는 USB CLI나 HID 디버그 채널로 대체. |

## 4. 문서/테스트 업데이트
- `docs/eeprom.md`: 로그 경량화 적용 후, Ready wait 통계를 어떻게 확인하는지 갱신하고 샘플 로그를 추가합니다.
- `docs/after.md` (본 문서): 진행 상태를 업데이트하면서 각 단계가 적용된 펌웨어 버전을 기록합니다.
- 테스트:  
  1. UART 로그 OFF 상태로 부팅 → 로그 버퍼/CLI 출력으로만 상태 확인.  
  2. EEPROM 대량 쓰기 시 Ready wait 요약 로그가 1~2줄로 제한되는지 확인.  
  3. 개발 빌드에서 플래그를 켠 경우 기존 상세 로그가 유지되는지 비교.

## 5. 리스크 및 대응
- 로그 축소로 인해 디버깅 정보가 부족해질 수 있으므로, `DEBUG_LOG_EEPROM` 같은 빌드옵션으로 기존 상세 로그를 복원할 수 있게 유지합니다.
- UART 로그를 끄면 초기에 문제 원인이 파악되지 못할 수 있으므로, 릴리스 노트에 “필요 시 CLI `log enable` 명령으로 즉시 활성화 가능” 문구를 포함합니다.
