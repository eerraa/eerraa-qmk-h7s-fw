# MONITOR Review 31 (V251008R3)

## 후보 1: 다운그레이드 불가 모드에서 누락 프레임 보고값 변환 지연
- 성능 영향: 현재는 이미 최저 속도(예: FS 1kHz)에서 점수가 임계에 도달해도 `missed_frames_report`를 16비트로 포화 변환하고 최소 1로 재조정한다. 그러나 이 값은 다운그레이드 큐가 존재할 때만 사용된다. 먼저 타깃 모드를 판별한 뒤 유효할 때만 변환을 수행하면, 최저 속도에서 반복적으로 홀드오프만 연장되는 구간에서 불필요한 산술과 분기를 피할 수 있다.
- 복잡도 영향: `usbHidResolveDowngradeTarget()` 결과를 검사한 뒤, 유효한 경우에만 변환·큐 요청을 묶어두면 제어 흐름이 더 명시적이다. 추가되는 블록은 짧고, 중첩 수준도 1단계 증가에 그친다.
- USB 불안정성 탐지 영향: 다운그레이드 타깃이 없을 때는 원래도 큐가 호출되지 않으므로, 보고값을 생성하지 않아도 감지·로그 동작은 동일하다. 홀드오프 갱신은 기존처럼 수행되어 재시도 타이밍도 변하지 않는다.
- 결론: 채택한다.

## 후보 2: 패널티 상한 계산을 상수 비교로 단순화
- 성능 영향: 누락 프레임이 최소 2 이상인 조건을 활용해 `missed_frames - 1`을 32비트 임시 변수에 저장한 뒤 다시 8비트로 캐스팅하는 과정을 제거하고, `USB_SOF_MONITOR_SCORE_CAP + 1`과의 단일 비교로 바로 패널티를 결정할 수 있다. 이로써 산술 및 저장 한 단계를 줄여 ISR 평균 경로를 더 가볍게 만든다.
- 복잡도 영향: 삼항 연산으로 상한·감소 케이스를 표현하면 코드가 한 줄로 정리되어 이전보다 읽기 쉬워진다. 추가 상태 변수도 필요 없다.
- USB 불안정성 탐지 영향: 안정 임계가 기대 간격의 두 배 이상이라 `missed_frames`는 항상 2 이상이고, 새 분기 역시 `min(missed_frames - 1, SCORE_CAP)` 결과를 그대로 유지한다. 따라서 점수 누적·다운그레이드 트리거 조건은 변하지 않는다.
- 결론: 채택한다.

## 후보 3: 감쇠 경로의 조기 반환 제거 후 단일 후처리 블록으로 통합
- 성능 영향: 조기 반환을 없애고 후처리 구역으로 분기시키면 `warmup_complete && delta_below_threshold` 경로에서 한 번 더 분기 검사를 수행해야 해 이득이 불확실하다.
- 복잡도 영향: 기존에는 감쇠 경로가 완료되면 즉시 반환해 이후 벌크 로직을 건너뛰는데, 후처리 블록으로 통합하려면 별도의 플래그나 `goto`가 필요해 제어 흐름이 복잡해진다.
- USB 불안정성 탐지 영향: 처리 순서를 바꾸는 과정에서 `last_decay_us` 갱신이나 점수 저장 타이밍이 미묘하게 달라질 우려가 있다. 워밍업 직후 첫 안정 프레임에서 감쇠가 누락되는 등의 회귀 가능성이 있어 리스크가 크다.
- 결론: 보류한다.
