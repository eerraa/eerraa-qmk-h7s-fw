# 정의 구조 정리 가이드 (V251114R3)

## 목적
- `hw_def.h`와 개별 키보드 `config.h`가 같은 정의라도 쓰임새가 다르므로, 기능 단위로 섹션을 나눠두면 유지보수와 코드 리뷰 부담을 줄일 수 있습니다.
- 매크로의 성격(보드 식별, 하드웨어 자원, 기능 토글 등)을 명확히 선언해두면, 다른 키보드로 포팅할 때 필요한 블록만 빠르게 이동할 수 있습니다.
- 변경 이력을 같은 버전 문자열(`_DEF_FIRMWATRE_VERSION`)과 함께 남기면, 문제 발생 시 영향을 받는 범위를 신속하게 추적할 수 있습니다.

## `src/hw/hw_def.h` 구성 아이디어
1. **식별/버전 블록**: `_DEF_FIRMWATRE_VERSION`, `_DEF_BOARD_NAME`를 맨 위에 두고, 동일 블록에 로그 기본값을 배치하면 릴리스 프로필 변경 시 한 번에 확인할 수 있습니다.
2. **안정성/보호 블록**: 자동 팩토리 리셋 활성화 여부, 쿠키 생성 매크로, 타이밍 계측 토글 등 빌드 타입별로 달라질 여지가 있는 매크로를 한 블록으로 묶습니다.
3. **하드웨어 사용 선언**: `_USE_HW_*` 선언부를 LED, UART, USB 등으로 세분화한 `hw_caps_*.h` 헤더에 배치하고, `hw_def.h`에서는 필요한 캡을 include만 수행합니다.
4. **USB 세부 구성**: `_USE_HW_VCOM`에 따라 달라지는 `HW_USB_*` 매크로는 `hw_caps_usb.h`에서 조건부로 처리해, 가상 COM을 켜도 다른 캡 파일을 수정할 필요가 없습니다.
5. **CLI/로그 리소스**: CLI 버퍼, GUI 치수, 로그 버퍼를 `hw_caps_cli.h`, `hw_caps_log.h`로 나누어 `HW_LOG_CH`가 어떤 UART를 바라보는지 명시합니다.

### `hw_caps_*.h` 헤더 운영 지침
- 위치: `src/hw/hw_caps_<subsystem>.h`, 예) `hw_caps_uart.h`, `hw_caps_usb.h`.
- 역할: 각 하위시스템에 필요한 `_USE_HW_*` 선언과 한계값(`HW_*`)을 정의. 기본값은 `#ifndef` 가드로 보호하므로, 키보드 `config.h`에서 값을 먼저 정의하면 그대로 유지됩니다.
- 확장: 신규 하위시스템이 추가되면 동일 규칙(파일 상단 `// VYYMMDDRn ...` 주석 + include guard + `_USE_HW_*` 기본값)을 따라 새로운 `hw_caps_*.h`를 만든 후 `hw_def.h`에 include 합니다.
- 예시: `_USE_HW_VCOM`을 활성화하면 `hw_caps_usb.h`가 자동으로 VCOM 프로필을 적용하고, 필요한 경우 `config.h`에서 `#define HW_USB_MSC 1`처럼 값을 재정의할 수 있습니다.
- 의존성 주석: 각 `hw_caps_*.h` 상단에는 `[Caps Dependencies]` 블록을 유지해 주요 사용처와 주의사항을 기록합니다. 값 변경 시 어떤 모듈을 함께 검토해야 하는지 판단 기준이 됩니다.

## `src/ap/modules/qmk/keyboards/era/sirind/brick60/config.h` 구성 아이디어
1. **보드 식별/USB**: 제품명과 VID/PID를 최상단에 두어 QA나 Vial/VIA 설정 확인 시 바로 접근할 수 있게 했습니다.
2. **hw_def.h 오버라이드**: 각 섹션 주석에 `hw_caps_*` 파일명을 병기하면, 어떤 캡 파일을 덮어쓰는지 즉시 알 수 있습니다. 예) WS2812 설정을 조정할 때 `hw_caps_led.h` 참조 안내를 덧붙입니다.
3. **EEPROM/매트릭스 블록**: 저장공간, 레이어 수, 키 배열/디바운스를 같은 영역에 두고, 입력 경로 변경 시 참고해야 할 값을 한 번에 볼 수 있습니다.
4. **입력/유틸리티 기능**: USB 모니터, BootMode, 탭핑 텀 등 펌웨어 동작을 제어하는 토글을 별도로 묶어 QA 시나리오에 대응합니다.
5. **RGB 라이트**: WS2812 관련 매크로와 RGBlight 이펙트를 하나의 블록으로 정리해, LED 구성이 바뀌어도 다른 섹션을 건드리지 않고 수정할 수 있게 했습니다.
6. **빌드 파라미터**: `RGBLIGHT_ENABLE`, `DEBOUNCE_TYPE` 등 CMake에서 필요한 토글은 config.h에 선언하면 `src/ap/modules/qmk/CMakeLists.txt`가 자동으로 파싱하여 관련 소스/정의 추가 여부를 결정합니다.

## 운영 팁
- 새로운 매크로를 추가할 때는 어떤 섹션/캡 파일에 속하는지 먼저 정의하고, 섹션 주석이나 파일 헤더에 한 줄 요약을 추가합니다.
- 키보드별 `config.h`는 가급적 `_USE_HW_*` 선언을 직접 다루지 않고, 필요 시 `hw_caps_*` 파일명을 주석으로 기재한 뒤 `#define` → `#undef` → `#define` 패턴으로 명시적으로 덮어씁니다.
- 현재 버전 문자열은 `V251114R3`을 사용 중이며, 정식 릴리스 버전은 사용자 확인 절차 후 확정해야 합니다.
