# V251012R5 RGB 인디케이터 추가 리팩토링 검토

## 검토 개요
- 대상: V251012R2~R4에서 정비한 Brick60 RGB 인디케이터 파이프라인.
- 목표: 남아 있는 중복 연산 및 인터럽트 경로의 불필요 호출을 보수적으로 제거해 안정성을 유지하며 오버헤드를 줄이는지 확인.

## 불필요 코드 / 사용 종료된 요소 정리
- V251012R2~R4 변경 후에도 모든 호출 경로가 필요한지 검토한 결과, 추가로 제거할 래퍼나 구조체는 확인되지 않음.
- 대신 동일한 구성/호스트 상태가 반복 전달되는 경로에서 로직을 재실행하던 부분을 early-return으로 정리.

## 성능 및 오버헤드 검토
- `rgblight_indicator_update_config()` 초입에서 현재 상태와 동일한 구성이 재전달될 경우 연산을 즉시 종료하도록 하여 HSV→RGB 캐시 갱신 및 `rgblight_set()` 요청을 생략. (V251012R5)
- `rgblight_indicator_apply_host_led()` 역시 직전 호스트 LED 상태와 동일한 값이 전달되면 상태 전이 검사를 건너뛰어 인터럽트 컨텍스트에서의 불필요한 함수 호출을 감소. (V251012R5)
- 두 경로 모두 상태 불일치 시에는 기존과 동일하게 동작하므로 기능 회귀 위험 없음.

## 제어 흐름 간소화
- 동일 상태 반복 입력을 빠르게 반환함으로써 제어 흐름이 명확해지고, 상태 전이가 필요한 경우에만 내부 함수를 호출하도록 경로를 좁힘.
- `rgblight_indicator_state` 내부 캐시 구조는 유지하여 R4에서 도입한 색상 캐싱 효과를 그대로 활용.

## 수정 적용 여부 판단
- 반복 호출 시 낭비되던 연산을 제거해 인터럽트 진입 비용과 렌더링 요청 수를 줄일 수 있음.
- early-return 조건은 입력값 그대로 비교하므로 오동작 리스크가 매우 낮음.

**결론: 수정 적용.**

---

## 이전 기록 (V251012R4)

- `rgblight_indicator_compute_color()`를 도입하여 HSV→RGB 변환을 구성 변경 시 한 번만 수행하고, 렌더링 시에는 캐시된 `rgb_led_t` 값을 그대로 복사.
- 캐시된 색상을 구조체 복사로 채우면서 `setrgb()` 호출 오버헤드를 제거해 루프 내 함수 호출을 없앰.
- 구성 변경 시 캐시 갱신과 상태 전이를 동시에 처리하도록 `rgblight_indicator_update_config()`를 정리하여 데이터 흐름을 한 곳에서 관리.
- VIA 경로가 직접 업데이트 함수를 호출하도록 변경해 함수 간 의존 관계를 축소.
- HSV→RGB 변환 캐싱과 함수 호출 축소로 렌더링 오버헤드 감소.
- 포트 계층 래퍼 제거로 코드 흐름 간결화 및 유지보수 용이성 향상.

