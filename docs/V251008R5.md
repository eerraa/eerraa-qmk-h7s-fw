# MONITOR Review 33 (V251008R5)

## 후보 1: `usbHidMeasureRateTime()`에서 `micros()` 단일 호출 공유
- 성능 영향: 데이터 IN 처리마다 최대 세 번 호출하던 `micros()`를 한 번으로 통합하면 인터럽트 이후의 측정 루틴이 마이크로초 타이머에 접근하는 횟수가 줄어든다. HS 8kHz 기준으로 초당 수천 번 실행되는 경로라 누적 CPU 사이클을 직접적으로 절약할 수 있다.
- 복잡도 영향: 함수 진입 시 타임스탬프를 한 번 확보하고, 이후 계산에서 동일 값을 재사용하도록 연산 순서만 정리하면 된다. 계산식이 단순해져 기존보다 읽기 쉽다.
- USB 불안정성 탐지 영향: SOF 기준 시각(`rate_time_sof_pre`)과 HID IN 완료 시각의 차이를 동일 타임스탬프로 계산하므로, 기존과 동일한 측정값을 유지한다. USB 모니터는 여전히 SOF ISR에서 동작하므로 탐지 로직에는 영향을 주지 않는다.
- 결론: 채택한다.

## 후보 2: SOF 모니터에서 `stable_threshold_us` 캐시 제거 후 기대 간격 기반 계산
- 성능 영향: 매 SOF마다 구조체에서 `stable_threshold_us`를 읽는 대신 `expected_us`를 한 번만 읽어 `expected_us * 2`로 임계값을 계산하면, 메모리 접근을 한 번 줄이고 캐시 복사를 위한 코드도 제거할 수 있다. 곱셈은 시프트 연산으로 대체되어 비용이 작다.
- 복잡도 영향: SOF 파라미터 테이블과 구조체 필드가 간소화되고, 임계 계산이 명확한 상수 배수로 표현돼 유지보수가 쉬워진다. 워밍업과 감쇠 흐름은 기존 분기와 동일하게 유지된다.
- USB 불안정성 탐지 영향: HS/FS 모두 `stable_threshold >= 2 * expected_us` 조건을 만족하도록 설계되어 있으므로, 두 배 배수 계산이 기존과 동일한 결과를 만든다. 워밍업·감쇠·다운그레이드 분기는 동일 조건에서 실행돼 탐지 로직 동작이 변하지 않는다.
- 결론: 채택한다.

## 후보 3: SOF 홀드오프 종료 후 `usbHidSofMonitorSyncTick()` 호출 생략
- 성능 영향: 홀드오프 만료 시 즉시 다음 프레임으로 넘어가면 한 번의 타임스탬프 동기화를 줄일 수 있지만, 홀드오프 구간은 다운그레이드 직후에만 실행되는 희귀 경로라 체감 이득이 미미하다.
- 복잡도 영향: 만료 분기에 추가 플래그를 도입하거나 `prev_tick_us` 갱신 순서를 재조정해야 한다. 워밍업·감쇠 분기와의 상호작용을 다시 검증해야 해 코드 복잡도가 올라간다.
- USB 불안정성 탐지 영향: 동기화 없이 다음 프레임으로 넘어가면 첫 프레임의 `delta_us`가 홀드오프 누적 시간을 포함할 수 있어 거짓 양성(downgrade)을 유발할 위험이 있다. 안정성 검증 비용이 높아진다.
- 결론: 보류한다.
