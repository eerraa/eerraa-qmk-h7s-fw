# MONITOR Review 34 (V251008R6)

## 개선안 후보 및 검토
1. **`expected_us == 0` 시 조기 반환으로 SOF 계산 생략**
   - 개요: 유효 속도 캐시가 비어 있을 때 워밍업/패널티 경로를 모두 건너뛰어 ISR 내 연산을 줄인다.
   - 1) 성능 영향: 기대 간격이 비어 있는 구간에서는 델타 비교와 임계 계산을 수행하지 않아 사이클이 절약된다.
   - 2) 복잡도: 단일 조기 반환 분기만 추가되어 기존 흐름을 크게 바꾸지 않는다.
   - 3) 비정상 가능성: 속도 캐시가 다시 채워질 때 Prime이 `prev_tick`/`last_decay`를 초기화하므로 USB 불안정성 감지는 정상 동작을 유지한다.
   - **결론: 채택**

2. **안정 임계 계산을 곱셈에서 시프트로 변경**
   - 개요: 안정 범위가 항상 기대 간격의 두 배이므로 좌측 시프트로 대체해 산술 비용을 축소한다.
   - 1) 성능 영향: 곱셈 대신 시프트/비교 한 번으로 충분해 ISR에서의 산술이 가벼워진다.
   - 2) 복잡도: 기존 상수를 시프트 값으로 확장해 구조를 유지하며, 유지보수 난이도는 동일하다.
   - 3) 비정상 가능성: 두 배 연산은 동일하게 보장되어 임계 판정이나 다운그레이드 조건에 변화가 없다.
   - **결론: 채택**

3. **홀드오프 구간에서 `usbHidSofMonitorSyncTick()` 호출 제거**
   - 1) 성능 영향: 호출을 제거하면 분기 하나는 줄지만, 홀드오프 해제 직후 델타가 누적되어 큰 패널티를 유발할 수 있다.
   - 2) 복잡도: 보조 동기화를 자체 구현해야 해 코드가 오히려 복잡해진다.
   - 3) 비정상 가능성: 홀드오프 종료 후 첫 프레임이 오차로 해석되어 다운그레이드를 잘못 유발할 위험이 크다.
   - **결론: 보류**

4. **패널티 누적을 16비트 누적으로 확장**
   - 1) 성능 영향: 8비트 누적을 16비트로 확장하면 오히려 산술 비용과 저장 공간이 증가한다.
   - 2) 복잡도: 구조체 정의와 큐 인터페이스 전반을 수정해야 해 복잡도가 크게 상승한다.
   - 3) 비정상 가능성: 상한 관리가 달라져 다운그레이드 트리거 임계와 어긋날 수 있다.
   - **결론: 기각**

## 최종 적용 개선안
- 1번, 2번 개선안을 기반으로 최종 코드를 작성하였다.
